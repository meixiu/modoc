[TOCM]

[TOC]

# 概要
标签是内置的执行命令，每个标签有具体的功能和用法。
标签使用的基础方法是 `{% 标签名 args1 操作符 args2 ... %}`，如：
```
{# 将bar()函数的执行结果赋值给 arr 变量 #}
{% set arr = bar()}

{# 循环 arr 变量 #}
{% for item in arr %}
...
{% endfor %}
```

# filter
对代码块里的所有内容应用指定的过滤器。

将所有的内容转成大写：
```
{% filter upper %}
    This text becomes uppercase
{% endfilter %}
```
还可以链接多个过滤器，先转成小写再去除html标签：
```
{% filter lower|e %}
    <strong>SOME TEXT</strong>
{% endfilter %}
```

#for
循环一个数组取出它的子元素。
```
<h1>Members</h1>
<ul>
    {% for user in users %}
        <li>{{ user.username }}</li>
    {% endfor %}
</ul>
```
也可以直接循环一个返回数组的函数:
```
{% for i in range(0, 10) %}
    * {{ i }}
{% endfor %}
```
可以使用 `else` 判断数组为空时的行为：
```
<ul>
    {% for user in users %}
        <li>{{ user.username|e }}</li>
    {% else %}
        <li><em>没有用户</em></li>
    {% endfor %}
</ul>
```
当循环一个关联数组时，可以同时获得键值和元素：
```
<h1>Members</h1>
<ul>
    {% for key, user in users %}
        <li>{{ key }}: {{ user.username|e }}</li>
    {% endfor %}
</ul>
```
可以追加条件判断语句过滤掉不想操作的元素：
```
<ul>
    {% for user in users if user.active %}
		{# 不活跃的用户不会显示出来 #}
        <li>{{ user.username }}</li>
    {% endfor %}
</ul>
```
这和下面的的结果是一样的，上面的方式更简洁，但下面的方式更容易理解：
```
<ul>
    {% for user in users %}
		{# 不活跃的用户不会显示出来 #}
		{% if user.active %}
        	<li>{{ user.username }}</li>
		{% endif %}
    {% endfor %}
</ul>
```
有时候我们需要知道当前循环的索引以及循环的元素位置，以便在页面上展示不同的效果。
在`for`循环块内部，内置了一个特殊的变量 `loop`:

|属性  |说明   |
| ------------ | ------------ |
| loop.index  | 循环的当前索引(从1开始) |
| loop.index0  |  循环的当前索引(从0开始) |
| loop.first   | 当前循环到的是否是第一个元素  |
| loop.last   |  当前循环到的是否是最后一个元素 |
|  loop.length |  循环数组的元素个数 |
|  loop.parent |  在嵌套的循环里代表上级循环的元素 |

#if
测试表达式的返回结果是否为真，如果为真则继续后面的代码块。

判断两个值是否相等：
```
{% if online == false %}
    <p>网站维护中，请稍后再试</p>
{% endif %}
```
判断一个数组是否有元素：
```
{% if users %}
    <ul>
        {% for user in users %}
            <li>{{ user.username|e }}</li>
        {% endfor %}
    </ul>
{% endif %}
```
判断一个数组的元素值是否为假：
```
{% if not user.subscribed %}
    <p>You are not subscribed to our mailing list.</p>
{% endif %}
```
>也可以做更精确的判断：

- `{% if foo.bar is defined %}` 变量是否已定义
- `{% if foo is empty %}` 变量是否为空（null，false，空数组，空字符串）
- `{{ var is null }}` 变量是否等于null
- `{{ var is even }}`	变量是否为偶数
- `{{ var is odd }}` 变量是否为奇数

使用`and`和`or`来组合条件：

```
{% if temperature > 18 and temperature < 27 %}
    <p>It's a nice day for a walk in the park.</p>
{% endif %}
```




条件分支：
```
{% if kenny.sick %}
    Kenny is sick.
{% elseif kenny.dead %}
    You killed Kenny! You bastard!!!
{% else %}
    Kenny looks okay --- so far
{% endif %}
```

判定表达式是否为`true`或`false`的规则是:

|  值 | Boolean  |
| ------------ | ------------ |
| 空的字符串  | false  |
|  数字0 |  false |
| 空白字符的字符串  | true   |
| 空的数组  |  false |
| null  |  false |
|  对象Object | true  |


# include
在当前模板中引入其它模板，并将该模板已渲染后的内容返回到当前模板。
```
{% include 'header.html' %}
    Body
{% include 'footer.html' %}
```
模板名称可以是任何有效的表达式计算出的结果：
```
{% include ajax ? 'ajax.html' : 'not_ajax.html' %}
{% include cate ~ '_index.html' %}
```
注：`~`为连接字符的操作符，类似于js里的`+`，php里的`.`

#extends
当前模板继承另外一个模板的主体结构，并覆写父模板`block`内的内容。
```
{% extends "base.html" %}
{% block content %}
    <h1>Index</h1>
    <p class="important">
        这里的内容将最终显示
        Welcome to my awesome homepage.
    </p>
{% endblock %}
```
详细参考：`模板引擎语法 > 模板继承(布局)`


#block
代码块被用于继承，同时也用于充当占位符和替换件。
在`extends`标签和`模板引擎语法 > 模板继承(布局)`中有更详细的介绍。


# set
给一个变量赋值。
```
{% set foo = 'bar' %}

{# 输出结果 'bar' #}
{{ foo }}
```
值可以是字符串，数组，关联数组，或者任何有效的表达试结果：
```
{% set foo = [1, 2] %}
{% set foo = {'foo': 'bar'} %}
{% set foo = 'foo' ~ 'bar' %}
```
值是一个函数运算的结果（在我们CMS系统中时常要用到）:
```
{# 调用get_article_list函数获取list数据 #}
{% set list = get_article_list(num=5, cateId=1)}

{# 循环list数组 #}
{% for item in list}
...
{% endfor %}
```
同时给多个变量赋值：
```
{% set foo, bar = 'foo', 'bar' %}

{# 和下面的方法结果是一样的，写起来更简洁 #}

{% set foo = 'foo' %}
{% set bar = 'bar' %}
```
将一大段文本块赋值给变量，以供后面使用：
```
{% set foo %}
    <div id="pagination">
        ...
    </div>
{% endset %}
```

更多高级用法请查阅：[Twig标签](https://www.kancloud.cn/yunye/twig-cn/159613 "Twig标签")

